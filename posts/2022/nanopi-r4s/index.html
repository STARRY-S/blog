<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>NanoPi R4S上手 & 安装Arch Linux ARM | STARRY-S' Blog</title>
<meta name=keywords content="软路由,Arch Linux,NanoPi"><meta name=description content="前两天下单了个Nano Pi R4S，4G内存的版本。通常情况下这玩意别人都把他当软路由用，但是今天咱收到货后想了一会拍大腿一寻思这玩意不就是个ARM架构的小电脑嘛~
所以咱暂时先不打算给这玩意装OpenWRT或 *WRT这类的路由器系统了，而是把它当成一个超小号的带俩网口的mini主机折腾。"><meta name=author content="STARRY-S"><link rel=canonical href=https://blog.starry-s.moe/posts/2022/nanopi-r4s/><link crossorigin=anonymous href=/assets/css/stylesheet.8cd7e7b23ccf6a26b5a720d9989e983050dcfab2e6de4beda008dc78cf697d32.css integrity="sha256-jNfnsjzPaia1pyDZmJ6YMFDc+rLm3kvtoAjceM9pfTI=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.starry-s.moe/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.starry-s.moe/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.starry-s.moe/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.starry-s.moe/apple-touch-icon.png><link rel=mask-icon href=https://blog.starry-s.moe/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog.starry-s.moe/posts/2022/nanopi-r4s/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://fastly.jsdelivr.net/npm/aplayer/dist/APlayer.min.css><script src=https://fastly.jsdelivr.net/npm/aplayer/dist/APlayer.min.js></script><script src=https://fastly.jsdelivr.net/npm/meting/dist/Meting.min.js></script><script>var meting_api="https://api.injahow.cn/meting/?server=:server&type=:type&id=:id&auth=:auth&r=:r"</script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#232323"><meta property="og:title" content="NanoPi R4S上手 & 安装Arch Linux ARM"><meta property="og:description" content="前两天下单了个Nano Pi R4S，4G内存的版本。通常情况下这玩意别人都把他当软路由用，但是今天咱收到货后想了一会拍大腿一寻思这玩意不就是个ARM架构的小电脑嘛~
所以咱暂时先不打算给这玩意装OpenWRT或 *WRT这类的路由器系统了，而是把它当成一个超小号的带俩网口的mini主机折腾。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.starry-s.moe/posts/2022/nanopi-r4s/"><meta property="og:image" content="https://blog.starry-s.moe/avatar.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-13T00:32:40+08:00"><meta property="article:modified_time" content="2022-05-13T00:32:40+08:00"><meta property="og:site_name" content="STARRY-S' Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.starry-s.moe/avatar.png"><meta name=twitter:title content="NanoPi R4S上手 & 安装Arch Linux ARM"><meta name=twitter:description content="前两天下单了个Nano Pi R4S，4G内存的版本。通常情况下这玩意别人都把他当软路由用，但是今天咱收到货后想了一会拍大腿一寻思这玩意不就是个ARM架构的小电脑嘛~
所以咱暂时先不打算给这玩意装OpenWRT或 *WRT这类的路由器系统了，而是把它当成一个超小号的带俩网口的mini主机折腾。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.starry-s.moe/posts/"},{"@type":"ListItem","position":2,"name":"2022","item":"https://blog.starry-s.moe/posts/2022/"},{"@type":"ListItem","position":3,"name":"NanoPi R4S上手 \u0026 安装Arch Linux ARM","item":"https://blog.starry-s.moe/posts/2022/nanopi-r4s/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"NanoPi R4S上手 \u0026 安装Arch Linux ARM","name":"NanoPi R4S上手 \u0026 安装Arch Linux ARM","description":"前两天下单了个Nano Pi R4S，4G内存的版本。通常情况下这玩意别人都把他当软路由用，但是今天咱收到货后想了一会拍大腿一寻思这玩意不就是个ARM架构的小电脑嘛~\n所以咱暂时先不打算给这玩意装OpenWRT或 *WRT这类的路由器系统了，而是把它当成一个超小号的带俩网口的mini主机折腾。\n","keywords":["软路由","Arch Linux","NanoPi"],"articleBody":"前两天下单了个Nano Pi R4S，4G内存的版本。通常情况下这玩意别人都把他当软路由用，但是今天咱收到货后想了一会拍大腿一寻思这玩意不就是个ARM架构的小电脑嘛~\n所以咱暂时先不打算给这玩意装OpenWRT或 *WRT这类的路由器系统了，而是把它当成一个超小号的带俩网口的mini主机折腾。\n开箱 USB 3.0、SD卡插槽以及三脚架接口\n供电接口和网口\n正面\n拆解 咱收到货后第一件事就是找螺丝刀和塑料卡片把这漏油器拆开看看（\n主板正面\n芯片的布局可以在R4S的商品页面查到，官方Wiki上也有更多关于R4S的介绍。\nArch Linux ARM 在Arch Linux ARM (简称alarm) 官网上没找到对R4S的官方的支持，简单搜了一下armbian有对R4S的官方支持。\n因为用惯了滚动更新发行版，所以不想用*bian系统，而*WRT系统的软件包相对其他发行版而言更少一些，系统也相当于被魔改过，所以除了做漏油器之外几乎干不了别的，所以这是我想安装Arch Linux的理由。\n然后咱搜到了一篇给NanoPi R2S安装alarm的教程，评论里有人提到了给R4S安装也是可以的。\n所以咱大致把这个教程翻译一下，再修改一些R2S和R4S在安装时的区别。\n以下内容需结合alarm的 aarch64通用安装教程食用，像更新pacman-key，ssh的密码之类的部分咱就不在这里重复了。\n准备SD卡 下载armbian的镜像，下载链接自行谷歌。\n通常下载好的文件是xz格式的压缩文件，需要使用unxz解压成img镜像。\n将armbian镜像的bootloader和uboot(32-32767区块的部分)用dd写到SD卡中：\n# Clean the sector before 32 dd if=/dev/zero of=/dev/sdX bs=1M count=32 # Write uBoot and bootloader dd if=Armbian_*.img of=/dev/sdX skip=31 seek=31 bs=512 count=32736 其实可以直接用dd把armbian的整个镜像写到内存卡中然后插入R4S开机，第一次开机后他会自动重新给内存卡分区，然后只需把/dev/sdX1格式化成ext4就能安装alarm了。\n使用fdisk给内存卡分区并格式化文件系统\n创建分区时先按o创建个MBR分区表，然后按n添加分区。第一个分区的起始区块(sector)需要设置为32768，通常情况下分一个区就够用了，或者你可以像我这样分俩区，一个给swap，不过实际没啥必要。\nDisk /dev/mmcblk1: 29.72 GiB, 31914983424 bytes, 62333952 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x33fc535e Device Boot Start End Sectors Size Id Type /dev/mmcblk1p1 32768 53944319 53911552 25.7G 83 Linux /dev/mmcblk1p2 53944320 62333951 8389632 4G 82 Linux swap / Solaris 创建完分区后，把root分区mkfs.ext4格式化成ext4，swap分区用mkswap格式化。\n解压alarm系统文件到root分区中\n复制并替换armbian的/boot中的文件到新建分区的/boot文件夹中。\n编辑/boot/armbianEnv.txt，更新rootdev的UUID 使用blkid或者lsblk -o+UUID可以查看UUID，注意是UUID不是PARTUUID。\n插电，开机 (此处不会出现五安大电牛)，网线连接R4S的WAN口到路由器的LAN口，第一次开机需要生成SSH Key所以时间会久一些，然后就可以ssh到R4S上去辣。\n内核 上述的安装步骤使用的armbian的内核，可以正常开机，但是想用Arch Linux stock aarch64内核的话，得替换一下DTB文件。（DTB文件是啥我目前还不清楚，如果后续弄明白了再更新到博客上吧）\nssh到R4S中，安装linux-aarch64。\n修改使用的DTB文件：\ncd /boot rm dtb ln -sf dtbs dtb 编辑armbianEnv.txt，在末尾添加一行fdtfile=rockchip/rk3399-rockpro64.dtb。\n在/boot/dtb/rockchip目录下是可以找到rk3399-nanopi-r4s.dtb文件的，但是目前用这个DTB的话会导致PCIE不能正常工作，导致LAN口无法使用。 dmesg的输出为：\ndmesg | grep pci [ 0.538310] ehci-pci: EHCI PCI platform driver [ 0.559708] ohci-pci: OHCI PCI platform driver [ 2.999933] rockchip-pcie f8000000.pcie: host bridge /pcie@f8000000 ranges: [ 2.999974] rockchip-pcie f8000000.pcie: MEM 0x00fa000000..0x00fbdfffff -\u003e 0x00fa000000 [ 2.999987] rockchip-pcie f8000000.pcie: IO 0x00fbe00000..0x00fbefffff -\u003e 0x00fbe00000 [ 3.000410] rockchip-pcie f8000000.pcie: no vpcie12v regulator found [ 3.500881] rockchip-pcie f8000000.pcie: PCIe link training gen1 timeout! [ 3.500944] rockchip-pcie: probe of f8000000.pcie failed with error -110 于是就先用rockpro64的DTB文件了。\n创建uBoot镜像和initramfs。\npacman -S uboot-tools mkimage -A arm64 -T ramdisk -n uInitrd -d /boot/initramfs-linux.img /boot/uInitrd-initramfs-linux.img ln -sf /boot/uInitrd-initramfs-linux.img /boot/uInitrd 创建个pacman的钩子，在以后更新linux-aarch64的时候自动的重新构建uboot和initramfs。\n在mkdir -p /etc/pacman.d/hooks目录下创建/etc/pacman.d/hooks/initramfs.hook\n[Trigger] Operation = Install Operation = Upgrade Type = Package Target = linux-aarch64 [Action] Description = Generate uInitrd Exec = /usr/bin/mkimage -A arm64 -T ramdisk -n uInitrd -d /boot/initramfs-linux.img /boot/uInitrd-initramfs-linux.img When = PostTransaction Depends = uboot-tools 重启，uname -a输出的应该是新版本的内核了。\n有个细节，用armbian的DTB文件时，开机后SYS LED灯是闪烁的，但是换到rockpro60的DTB文件后只有PWR灯长亮，别的灯都不闪了。\nRouter 虽然装的是Arch Linux ARM系统，但是这并不代表它不能作为一个路由器使用。\n系统默认用的是systemd-networkd管理网络，所以以下内容使用systemd-networkd配置路由器，暂时没遇到问题，如果不行的话我再换别的。\n参考: Router - ArchWiki\n重命名网络接口 这一步并非必须，但是我有遇到重启系统后网口从eth0变成eth1的情况，所以还是给网口重命个名好一些。\n首先移除并备份/etc/systemd/network中原有的配置文件。\ncd /etc/systemd/network # backup config files mv ./* /root/ 获取WAN口的mac地址。\ncat /sys/class/net/eth0/address 12:34:56:78:90:ab 创建10-extern0.link，重命名eth0到extern0。\n[Match] MACAddress=12:34:56:78:90:ab [Link] Description=WAN Name=extern0 另一个网口(LAN)在开机时systemd-networkd会自动给他重命名为enp1s0。\nWAN口配置DHCP客户端 这里我是把R4S的WAN口接到另一台路由器的LAN上，所以配置的是DHCP客户端。如果你打算直接把路由器接光猫，而且你的猫设置了桥接，那么你可能需要配置PPPOE。\n创建20-extern0.network。\n[Match] Name=extern0 [Network] DHCP=yes LAN口配置静态IP和DHCP服务器 给LAN口设置成另一个网络的静态IP地址，并配置DHCP服务器，给连接到LAN口的机器分配同一个网络下的其他IP地址。\n创建20-enp1s0.network。\n[Match] Name=enp1s0 [Network] Address=10.0.0.1/24 DHCPServer=true IPMasquerade=both [DHCPServer] PoolOffset=100 PoolSize=100 EmitDNS=yes # DNS=8.8.8.8 我这个配置是给LAN口设置了静态IP地址10.0.0.1，掩码255.255.255.0，启用了DHCP服务器， 设置了IPv4数据“伪装”(packets forwarded from the network interface will be appear as coming from the local host)。\n有关配置文件的参数可以使用man systemd.network查询。\n暂时还没搞懂怎么折腾IPv6，如果配置好IPv6的话我再补上……\n后续 之后咱装了JDK以及一堆我常用的小组件。为了测试性能，我把我以前备份的Minecraft服务器复制到R4S上跑了一下试试。我的服务器之前是在疼讯云学生主机上跑的(1核2G)，装了好多性能优化插件(lithium，phosphor，carpet…)，版本是1.16.4，抱着尝试的心态跑了一下这个服务器结果发现很流畅，一开始区块加载的时候CPU的6个核心全跑满，之后就恢复到正常水平了。刚才尝试了一下长时间的生成区块貌似没什么大的问题，只要别一直用鞘翅跑图就行，应该是内存够用了所以运行效果要好一些，不过单核性能来讲的话肯定还是X86吊打R4S的。\n毕竟这就是半个巴掌大小的机器，跑MC的时候CPU温度才不到50度，应该不需要主动散热，功耗才十多瓦……\nMineCraft Server Performance\nArch Linux ARM\n参烤链接 NanoPi R4S NanoPi R4S - FriendlyELEC WiKi Installing Arch Linux AArch64 on the NanoPi R2S Generic AArch64 Installation | Arch Linux ARM Router - ArchWiki systemd-networkd - ArchWiki systemd.network(5) — Arch manual pages 在 NanoPi R2S 上安装 Archlinuxarm - 知乎 ","wordCount":"3025","inLanguage":"zh","image":"https://blog.starry-s.moe/avatar.png","datePublished":"2022-05-13T00:32:40+08:00","dateModified":"2022-05-13T00:32:40+08:00","author":{"@type":"Person","name":"STARRY-S"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.starry-s.moe/posts/2022/nanopi-r4s/"},"publisher":{"@type":"Organization","name":"STARRY-S' Blog","logo":{"@type":"ImageObject","url":"https://blog.starry-s.moe/favicon-32x32.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.starry-s.moe/ accesskey=h title="Blog (Alt + H)"><img src=https://blog.starry-s.moe/apple-touch-icon.png alt aria-label=logo height=24>Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.starry-s.moe/gallery/ title=相册><span>相册</span></a></li><li><a href=https://blog.starry-s.moe/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.starry-s.moe/tags/ title=标签><span>标签</span></a></li><li><a href=https://blog.starry-s.moe/categories/ title=分类><span>分类</span></a></li><li><a href=https://blog.starry-s.moe/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.starry-s.moe/projects/ title=项目><span>项目</span></a></li><li><a href=https://blog.starry-s.moe/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.starry-s.moe/>主页</a>&nbsp;»&nbsp;<a href=https://blog.starry-s.moe/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://blog.starry-s.moe/posts/2022/>2022</a></div><h1 class="post-title entry-hint-parent">NanoPi R4S上手 & 安装Arch Linux ARM</h1><div class=post-meta><span title='2022-05-13 00:32:40 +0800 +0800'>2022-05-13 00:32:40 +0800</span>&nbsp;·&nbsp;7 分钟&nbsp;·&nbsp;3025 字&nbsp;·&nbsp;STARRY-S&nbsp;|&nbsp;<a href=https://github.com/STARRY-S/blog/edit/main/content/posts/2022/nanopi-r4s/index.md rel="noopener noreferrer" target=_blank>Edit Text</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#开箱>开箱</a></li><li><a href=#拆解>拆解</a></li><li><a href=#arch-linux-arm>Arch Linux ARM</a><ul><li><a href=#准备sd卡>准备SD卡</a></li><li><a href=#内核>内核</a></li></ul></li><li><a href=#router>Router</a><ul><li><a href=#重命名网络接口>重命名网络接口</a></li><li><a href=#wan口配置dhcp客户端>WAN口配置DHCP客户端</a></li><li><a href=#lan口配置静态ip和dhcp服务器>LAN口配置静态IP和DHCP服务器</a></li></ul></li><li><a href=#后续>后续</a></li><li><a href=#参烤链接>参烤链接</a></li></ul></nav></div></details></div><div class=post-content><p>前两天下单了个Nano Pi R4S，4G内存的版本。通常情况下这玩意别人都把他当软路由用，但是今天咱收到货后想了一会拍大腿一寻思这玩意不就是个ARM架构的小电脑嘛~</p><p>所以咱暂时先不打算给这玩意装OpenWRT或 *WRT这类的路由器系统了，而是把它当成一个超小号的带俩网口的mini主机折腾。</p><meting-js server=netease type=song id=19563215 theme=#233333></meting-js><h2 id=开箱>开箱<a hidden class=anchor aria-hidden=true href=#开箱>#</a></h2><p><img loading=lazy src=images/nanopi_1.jpg alt="&amp;ldquo;USB 3.0、SD卡插槽以及三脚架接口&amp;rdquo;"><p style=margin-bottom:-.8em class=image-title>USB 3.0、SD卡插槽以及三脚架接口</p></p><p><img loading=lazy src=images/nanopi_2.jpg alt=&amp;ldquo;供电接口和网口&amp;rdquo;><p style=margin-bottom:-.8em class=image-title>供电接口和网口</p></p><p><img loading=lazy src=images/nanopi_3.jpg alt=&amp;ldquo;正面&amp;rdquo;><p style=margin-bottom:-.8em class=image-title>正面</p></p><h2 id=拆解>拆解<a hidden class=anchor aria-hidden=true href=#拆解>#</a></h2><p>咱收到货后第一件事就是找螺丝刀和塑料卡片把这漏油器拆开看看（</p><p><img loading=lazy src=images/nanopi_7.jpg alt><p style=margin-bottom:-.8em class=image-title>主板正面</p></p><p>芯片的布局可以在<a href="https://www.friendlyelec.com/index.php?route=product/product&product_id=284">R4S的商品页面</a>查到，<a href=https://wiki.friendlyelec.com/wiki/index.php/NanoPi_R4S>官方Wiki</a>上也有更多关于R4S的介绍。</p><h2 id=arch-linux-arm>Arch Linux ARM<a hidden class=anchor aria-hidden=true href=#arch-linux-arm>#</a></h2><p>在Arch Linux ARM (简称alarm) 官网上没找到对R4S的官方的支持，简单搜了一下armbian有对R4S的官方支持。</p><p>因为用惯了<strong>滚动更新</strong>发行版，所以不想用*bian系统，而*WRT系统的软件包相对其他发行版而言更少一些，系统也相当于被魔改过，所以除了做漏油器之外几乎干不了别的，所以这是我想安装Arch Linux的理由。</p><p>然后咱搜到了一篇给<a href=https://gist.github.com/larsch/a8f13faa2163984bb945d02efb897e6d>NanoPi R2S安装alarm的教程</a>，评论里有人提到了给R4S安装也是可以的。</p><p>所以咱大致把这个教程翻译一下，再修改一些R2S和R4S在安装时的区别。</p><p>以下内容需结合alarm的 <a href=https://archlinuxarm.org/platforms/armv8/generic>aarch64通用安装教程</a>食用，像更新pacman-key，ssh的密码之类的部分咱就不在这里重复了。</p><h3 id=准备sd卡>准备SD卡<a hidden class=anchor aria-hidden=true href=#准备sd卡>#</a></h3><ol start=0><li><p>下载armbian的镜像，下载链接自行谷歌。</p><blockquote><p>通常下载好的文件是<code>xz</code>格式的压缩文件，需要使用<code>unxz</code>解压成<code>img</code>镜像。</p></blockquote></li><li><p>将armbian镜像的<code>bootloader</code>和<code>uboot</code>(32-32767区块的部分)用<code>dd</code>写到SD卡中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># Clean the sector before 32</span>
</span></span><span class=line><span class=cl><span class=n>dd</span> <span class=k>if</span><span class=o>=/</span><span class=n>dev</span><span class=o>/</span><span class=n>zero</span> <span class=n>of</span><span class=o>=/</span><span class=n>dev</span><span class=o>/</span><span class=n>sdX</span> <span class=n>bs</span><span class=o>=</span><span class=mi>1</span><span class=n>M</span> <span class=n>count</span><span class=o>=</span><span class=mi>32</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Write uBoot and bootloader</span>
</span></span><span class=line><span class=cl><span class=n>dd</span> <span class=k>if</span><span class=o>=</span><span class=n>Armbian_</span><span class=o>*.</span><span class=n>img</span> <span class=n>of</span><span class=o>=/</span><span class=n>dev</span><span class=o>/</span><span class=n>sdX</span> <span class=n>skip</span><span class=o>=</span><span class=mi>31</span> <span class=n>seek</span><span class=o>=</span><span class=mi>31</span> <span class=n>bs</span><span class=o>=</span><span class=mi>512</span> <span class=n>count</span><span class=o>=</span><span class=mi>32736</span>
</span></span></code></pre></div><blockquote><p>其实可以直接用<code>dd</code>把armbian的整个镜像写到内存卡中然后插入R4S开机，第一次开机后他会自动重新给内存卡分区，然后只需把<code>/dev/sdX1</code>格式化成ext4就能安装alarm了。</p></blockquote></li><li><p>使用<code>fdisk</code>给内存卡分区并格式化文件系统</p><p>创建分区时先按<code>o</code>创建个MBR分区表，然后按<code>n</code>添加分区。第一个分区的起始区块(sector)需要设置为32768，通常情况下分一个区就够用了，或者你可以像我这样分俩区，一个给swap，不过实际没啥必要。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Disk /dev/mmcblk1: 29.72 GiB, 31914983424 bytes, 62333952 sectors
</span></span><span class=line><span class=cl>Units: sectors of 1 * 512 = 512 bytes
</span></span><span class=line><span class=cl>Sector size (logical/physical): 512 bytes / 512 bytes
</span></span><span class=line><span class=cl>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span></span><span class=line><span class=cl>Disklabel type: dos
</span></span><span class=line><span class=cl>Disk identifier: 0x33fc535e
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Device         Boot    Start      End  Sectors  Size Id Type
</span></span><span class=line><span class=cl>/dev/mmcblk1p1         32768 53944319 53911552 25.7G 83 Linux
</span></span><span class=line><span class=cl>/dev/mmcblk1p2      53944320 62333951  8389632    4G 82 Linux swap / Solaris
</span></span></code></pre></div><p>创建完分区后，把<code>root</code>分区<code>mkfs.ext4</code>格式化成ext4，swap分区用<code>mkswap</code>格式化。</p></li><li><p>解压alarm系统文件到root分区中</p></li><li><p>复制并替换armbian的<code>/boot</code>中的文件到新建分区的<code>/boot</code>文件夹中。</p></li><li><p>编辑<code>/boot/armbianEnv.txt</code>，更新<code>rootdev</code>的UUID
使用<code>blkid</code>或者<code>lsblk -o+UUID</code>可以查看UUID，注意是<strong>UUID</strong>不是PARTUUID。</p></li><li><p>插电，开机 (<del>此处不会出现五安大电牛</del>)，网线连接R4S的WAN口到路由器的LAN口，第一次开机需要生成SSH Key所以时间会久一些，然后就可以ssh到R4S上去辣。</p></li></ol><h3 id=内核>内核<a hidden class=anchor aria-hidden=true href=#内核>#</a></h3><p>上述的安装步骤使用的armbian的内核，可以正常开机，但是想用Arch Linux stock aarch64内核的话，得替换一下DTB文件。（DTB文件是啥我目前还不清楚，如果后续弄明白了再更新到博客上吧）</p><ol><li><p>ssh到R4S中，安装<code>linux-aarch64</code>。</p></li><li><p>修改使用的DTB文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd /boot
</span></span><span class=line><span class=cl>rm dtb
</span></span><span class=line><span class=cl>ln -sf dtbs dtb
</span></span></code></pre></div><p>编辑<code>armbianEnv.txt</code>，在末尾添加一行<code>fdtfile=rockchip/rk3399-rockpro64.dtb</code>。</p><blockquote><p>在<code>/boot/dtb/rockchip</code>目录下是可以找到<code>rk3399-nanopi-r4s.dtb</code>文件的，但是目前用这个DTB的话会导致PCIE不能正常工作，导致LAN口无法使用。
<code>dmesg</code>的输出为：</p></blockquote><blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-prolog data-lang=prolog><span class=line><span class=cl><span class=s>dmesg</span> <span class=p>|</span> <span class=s>grep</span> <span class=s>pci</span>
</span></span><span class=line><span class=cl><span class=p>[</span>    <span class=mf>0.538310</span><span class=p>]</span> <span class=s>ehci</span><span class=o>-</span><span class=nn>pci</span><span class=p>:</span> <span class=nv>EHCI</span> <span class=nv>PCI</span> <span class=s>platform</span> <span class=s>driver</span>
</span></span><span class=line><span class=cl><span class=p>[</span>    <span class=mf>0.559708</span><span class=p>]</span> <span class=s>ohci</span><span class=o>-</span><span class=nn>pci</span><span class=p>:</span> <span class=nv>OHCI</span> <span class=nv>PCI</span> <span class=s>platform</span> <span class=s>driver</span>
</span></span><span class=line><span class=cl><span class=p>[</span>    <span class=mf>2.999933</span><span class=p>]</span> <span class=s>rockchip</span><span class=o>-</span><span class=s>pcie</span> <span class=s>f8000000</span><span class=p>.</span><span class=nn>pcie</span><span class=p>:</span> <span class=s>host</span> <span class=s>bridge</span> <span class=o>/</span><span class=s>pcie@f8000000</span> <span class=nn>ranges</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>[</span>    <span class=mf>2.999974</span><span class=p>]</span> <span class=s>rockchip</span><span class=o>-</span><span class=s>pcie</span> <span class=s>f8000000</span><span class=p>.</span><span class=nn>pcie</span><span class=p>:</span>      <span class=nv>MEM</span> <span class=mh>0x00fa000000</span><span class=p>.</span><span class=mf>.0</span><span class=s>x00fbdfffff</span> <span class=s>-&gt;</span> <span class=mh>0x00fa000000</span>
</span></span><span class=line><span class=cl><span class=p>[</span>    <span class=mf>2.999987</span><span class=p>]</span> <span class=s>rockchip</span><span class=o>-</span><span class=s>pcie</span> <span class=s>f8000000</span><span class=p>.</span><span class=nn>pcie</span><span class=p>:</span>       <span class=nv>IO</span> <span class=mh>0x00fbe00000</span><span class=p>.</span><span class=mf>.0</span><span class=s>x00fbefffff</span> <span class=s>-&gt;</span> <span class=mh>0x00fbe00000</span>
</span></span><span class=line><span class=cl><span class=p>[</span>    <span class=mf>3.000410</span><span class=p>]</span> <span class=s>rockchip</span><span class=o>-</span><span class=s>pcie</span> <span class=s>f8000000</span><span class=p>.</span><span class=nn>pcie</span><span class=p>:</span> <span class=s>no</span> <span class=s>vpcie12v</span> <span class=s>regulator</span> <span class=s>found</span>
</span></span><span class=line><span class=cl><span class=p>[</span>    <span class=mf>3.500881</span><span class=p>]</span> <span class=s>rockchip</span><span class=o>-</span><span class=s>pcie</span> <span class=s>f8000000</span><span class=p>.</span><span class=nn>pcie</span><span class=p>:</span> <span class=nv>PCIe</span> <span class=s>link</span> <span class=s>training</span> <span class=s>gen1</span> <span class=s>timeout</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span>    <span class=mf>3.500944</span><span class=p>]</span> <span class=s>rockchip</span><span class=o>-</span><span class=nn>pcie</span><span class=p>:</span> <span class=s>probe</span> <span class=s>of</span> <span class=s>f8000000</span><span class=p>.</span><span class=s>pcie</span> <span class=s>failed</span> <span class=s>with</span> <span class=s>error</span> <span class=o>-</span><span class=mi>110</span>
</span></span></code></pre></div><p>于是就先用rockpro64的DTB文件了。</p></blockquote></li><li><p>创建uBoot镜像和initramfs。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pacman -S uboot-tools
</span></span><span class=line><span class=cl>mkimage -A arm64 -T ramdisk -n uInitrd -d /boot/initramfs-linux.img /boot/uInitrd-initramfs-linux.img
</span></span><span class=line><span class=cl>ln -sf /boot/uInitrd-initramfs-linux.img /boot/uInitrd
</span></span></code></pre></div><p>创建个<code>pacman</code>的钩子，在以后更新<code>linux-aarch64</code>的时候自动的重新构建uboot和initramfs。</p><p>在<code>mkdir -p /etc/pacman.d/hooks</code>目录下创建<code>/etc/pacman.d/hooks/initramfs.hook</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-pacmanconf data-lang=pacmanconf><span class=line><span class=cl><span class=k>[Trigger]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Operation</span> <span class=o>=</span> Install<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Operation</span> <span class=o>=</span> Upgrade<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Type</span> <span class=o>=</span> Package<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Target</span> <span class=o>=</span> linux-aarch64<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>
</span></span></span><span class=line><span class=cl><span class=k>[Action]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Description</span> <span class=o>=</span> Generate uInitrd<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Exec</span> <span class=o>=</span> /usr/bin/mkimage -A arm64 -T ramdisk -n uInitrd -d /boot/initramfs-linux.img /boot/uInitrd-initramfs-linux.img<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>When</span> <span class=o>=</span> PostTransaction<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Depends</span> <span class=o>=</span> uboot-tools<span class=err>
</span></span></span></code></pre></div></li><li><p>重启，<code>uname -a</code>输出的应该是新版本的内核了。</p><p>有个细节，用armbian的DTB文件时，开机后SYS LED灯是闪烁的，但是换到rockpro60的DTB文件后只有PWR灯长亮，别的灯都不闪了。</p></li></ol><h2 id=router>Router<a hidden class=anchor aria-hidden=true href=#router>#</a></h2><p>虽然装的是Arch Linux ARM系统，但是这并不代表它不能作为一个路由器使用。</p><p>系统默认用的是<code>systemd-networkd</code>管理网络，所以以下内容使用<code>systemd-networkd</code>配置路由器，暂时没遇到问题，如果不行的话我再换别的。</p><blockquote><p>参考: <a href=https://wiki.archlinux.org/title/Router>Router - ArchWiki</a></p></blockquote><h3 id=重命名网络接口>重命名网络接口<a hidden class=anchor aria-hidden=true href=#重命名网络接口>#</a></h3><blockquote><p>这一步并非必须，但是我有遇到重启系统后网口从<code>eth0</code>变成<code>eth1</code>的情况，所以还是给网口重命个名好一些。</p></blockquote><p>首先移除并备份<code>/etc/systemd/network</code>中原有的配置文件。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /etc/systemd/network
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># backup config files</span>
</span></span><span class=line><span class=cl>mv ./* /root/
</span></span></code></pre></div><p>获取WAN口的mac地址。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /sys/class/net/eth0/address
</span></span><span class=line><span class=cl>12:34:56:78:90:ab
</span></span></code></pre></div><p>创建<code>10-extern0.link</code>，重命名<code>eth0</code>到<code>extern0</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-pacmanconf data-lang=pacmanconf><span class=line><span class=cl><span class=k>[Match]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>MACAddress</span><span class=o>=</span>12:34:56:78:90:ab<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>
</span></span></span><span class=line><span class=cl><span class=k>[Link]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Description</span><span class=o>=</span>WAN<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Name</span><span class=o>=</span>extern0<span class=err>
</span></span></span></code></pre></div><p>另一个网口(LAN)在开机时<code>systemd-networkd</code>会自动给他重命名为<code>enp1s0</code>。</p><h3 id=wan口配置dhcp客户端>WAN口配置DHCP客户端<a hidden class=anchor aria-hidden=true href=#wan口配置dhcp客户端>#</a></h3><p>这里我是把R4S的WAN口接到另一台路由器的LAN上，所以配置的是DHCP客户端。如果你打算直接把路由器接光猫，而且你的猫设置了桥接，那么你可能需要配置PPPOE。</p><p>创建<code>20-extern0.network</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-pacmanconf data-lang=pacmanconf><span class=line><span class=cl><span class=k>[Match]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Name</span><span class=o>=</span>extern0<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>
</span></span></span><span class=line><span class=cl><span class=k>[Network]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>DHCP</span><span class=o>=</span>yes<span class=err>
</span></span></span></code></pre></div><h3 id=lan口配置静态ip和dhcp服务器>LAN口配置静态IP和DHCP服务器<a hidden class=anchor aria-hidden=true href=#lan口配置静态ip和dhcp服务器>#</a></h3><p>给LAN口设置成另一个网络的静态IP地址，并配置DHCP服务器，给连接到LAN口的机器分配同一个网络下的其他IP地址。</p><p>创建<code>20-enp1s0.network</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-pacmanconf data-lang=pacmanconf><span class=line><span class=cl><span class=k>[Match]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Name</span><span class=o>=</span>enp1s0<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>
</span></span></span><span class=line><span class=cl><span class=k>[Network]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>Address</span><span class=o>=</span>10.0.0.1/24<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>DHCPServer</span><span class=o>=</span>true<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>IPMasquerade</span><span class=o>=</span>both<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>
</span></span></span><span class=line><span class=cl><span class=k>[DHCPServer]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>PoolOffset</span><span class=o>=</span>100<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>PoolSize</span><span class=o>=</span>100<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=na>EmitDNS</span><span class=o>=</span>yes<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c1># DNS=8.8.8.8</span><span class=err>
</span></span></span></code></pre></div><p>我这个配置是给LAN口设置了静态IP地址<code>10.0.0.1</code>，掩码<code>255.255.255.0</code>，启用了DHCP服务器，
设置了IPv4数据“伪装”(packets forwarded from the network interface will be appear as coming from the local host)。</p><p>有关配置文件的参数可以使用<code>man systemd.network</code>查询。</p><p>暂时还没搞懂怎么折腾IPv6，如果配置好IPv6的话我再补上……</p><h2 id=后续>后续<a hidden class=anchor aria-hidden=true href=#后续>#</a></h2><p>之后咱装了JDK以及一堆我常用的小组件。为了测试性能，我把我以前备份的Minecraft服务器复制到R4S上跑了一下试试。我的服务器之前是在疼讯云学生主机上跑的(1核2G)，装了好多性能优化插件(lithium，phosphor，carpet&mldr;)，版本是1.16.4，抱着尝试的心态跑了一下这个服务器结果发现很流畅，一开始区块加载的时候CPU的6个核心全跑满，之后就恢复到正常水平了。刚才尝试了一下长时间的生成区块貌似没什么大的问题，只要别一直用鞘翅跑图就行，应该是内存够用了所以运行效果要好一些，不过单核性能来讲的话肯定还是X86吊打R4S的。</p><p>毕竟这就是半个巴掌大小的机器，跑MC的时候CPU温度才不到50度，应该不需要主动散热，功耗才十多瓦……</p><p><img loading=lazy src=images/nanopi_performance.png alt="&amp;ldquo;MineCraft Server Performance&amp;rdquo;"><p style=margin-bottom:-.8em class=image-title>MineCraft Server Performance</p></p><p><img loading=lazy src=images/nanopi_neofetch.png alt="&amp;ldquo;Arch Linux ARM&amp;rdquo;"><p style=margin-bottom:-.8em class=image-title>Arch Linux ARM</p></p><h2 id=参烤链接>参烤链接<a hidden class=anchor aria-hidden=true href=#参烤链接>#</a></h2><ul><li><a href="https://www.friendlyelec.com/index.php?route=product/product&product_id=284">NanoPi R4S</a></li><li><a href=https://wiki.friendlyelec.com/wiki/index.php/NanoPi_R4S>NanoPi R4S - FriendlyELEC WiKi</a></li><li><a href=https://gist.github.com/larsch/a8f13faa2163984bb945d02efb897e6d>Installing Arch Linux AArch64 on the NanoPi R2S</a></li><li><a href=https://archlinuxarm.org/platforms/armv8/generic>Generic AArch64 Installation | Arch Linux ARM</a></li><li><a href=https://wiki.archlinux.org/title/Router>Router - ArchWiki</a></li><li><a href=https://wiki.archlinux.org/title/Systemd-networkd>systemd-networkd - ArchWiki</a></li><li><a href=https://man.archlinux.org/man/systemd.network.5>systemd.network(5) — Arch manual pages</a></li><li><a href=https://zhuanlan.zhihu.com/p/392619184>在 NanoPi R2S 上安装 Archlinuxarm - 知乎</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.starry-s.moe/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/>软路由</a></li><li><a href=https://blog.starry-s.moe/tags/arch-linux/>Arch Linux</a></li><li><a href=https://blog.starry-s.moe/tags/nanopi/>NanoPi</a></li></ul><nav class=paginav><a class=prev href=https://blog.starry-s.moe/posts/2022/archlinux-router/><span class=title>« 上一页</span><br><span>在Arch Linux上配置软路由</span>
</a><a class=next href=https://blog.starry-s.moe/posts/2022/miniflux-build/><span class=title>下一页 »</span><br><span>自建RSS服务器：Miniflux</span></a></nav></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//starry-s-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>© 2016 - 2025 STARRY-S | <a href=https://creativecommons.org/licenses/by-nc-nd/4.0/>CC BY-NC-ND 4.0</a> | Hosted on <a href=https://pages.github.com>GitHub Pages</a><br></span>·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>const pathname=window.location.pathname,images=document.querySelectorAll("img");Array.from(images).forEach(e=>{if(!pathname.includes("/posts/"))return;if(e.src.indexOf("images")<0)return;e.addEventListener("load",()=>fitImage(e)),e.complete&&e.naturalWidth!==0&&fitImage(e)});function fitImage(e){e.style.marginLeft="auto",e.style.marginRight="auto",e.naturalWidth/e.naturalHeight<1.1&&(e.style.maxWidth="60%",e.style.height="auto")}</script><script src=/js/home-info.js></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>