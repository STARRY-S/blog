<!DOCTYPE html>
<html lang="zh" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>联想 ThinkBook 16 Gen6 安装 Arch Linux | STARRY-S&#39; Blog</title>
<meta name="keywords" content="Arch Linux">
<meta name="description" content="本来没打算这么早换笔记本，但是之前大学时买的联想 R7000P 它坏了……">
<meta name="author" content="STARRY-S">
<link rel="canonical" href="https://blog.starry-s.moe/posts/2024/lenovo-thinkbook-16-6g/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5ea96d65090d903c4b3b57af33f9766457193cbe3c48470b654d56684cce3656.css" integrity="sha256-XqltZQkNkDxLO1evM/l2ZFcZPL48SEcLZU1WaEzONlY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.starry-s.moe/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.starry-s.moe/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.starry-s.moe/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.starry-s.moe/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.starry-s.moe/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://blog.starry-s.moe/posts/2024/lenovo-thinkbook-16-6g/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://fastly.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<script src="https://fastly.jsdelivr.net/npm/meting/dist/Meting.min.js"></script>

<script>
  var meting_api='https://api.injahow.cn/meting/?server=:server&type=:type&id=:id&auth=:auth&r=:r';
</script><link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />

<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#232323">
<meta property="og:url" content="https://blog.starry-s.moe/posts/2024/lenovo-thinkbook-16-6g/">
  <meta property="og:site_name" content="STARRY-S&#39; Blog">
  <meta property="og:title" content="联想 ThinkBook 16 Gen6 安装 Arch Linux">
  <meta property="og:description" content="本来没打算这么早换笔记本，但是之前大学时买的联想 R7000P 它坏了……">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-05T01:02:47+08:00">
    <meta property="article:modified_time" content="2024-08-05T01:02:47+08:00">
    <meta property="article:tag" content="Arch Linux">
      <meta property="og:image" content="https://blog.starry-s.moe/web-app-manifest-512x512.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.starry-s.moe/web-app-manifest-512x512.png">
<meta name="twitter:title" content="联想 ThinkBook 16 Gen6 安装 Arch Linux">
<meta name="twitter:description" content="本来没打算这么早换笔记本，但是之前大学时买的联想 R7000P 它坏了……">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.starry-s.moe/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "联想 ThinkBook 16 Gen6 安装 Arch Linux",
      "item": "https://blog.starry-s.moe/posts/2024/lenovo-thinkbook-16-6g/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "联想 ThinkBook 16 Gen6 安装 Arch Linux",
  "name": "联想 ThinkBook 16 Gen6 安装 Arch Linux",
  "description": "本来没打算这么早换笔记本，但是之前大学时买的联想 R7000P 它坏了……\n",
  "keywords": [
    "Arch Linux"
  ],
  "articleBody": "本来没打算这么早换笔记本，但是之前大学时买的联想 R7000P 它坏了……\n起因 这段基本是废话，可以直接跳过……\n旧笔记本经常蓝屏死机掉驱动重启，送修过一次但依旧没修好，于是把它当有问题的二手电脑卖掉了，买了今年新出的联想 ThinkBook 16 Gen6。因为咱有台式，所以笔记本的需求就是轻薄，Linux 友好，便宜就行。之前总是被笔记本的双显卡驱动折磨得头疼，英伟达显卡驱动 4202 年了依旧是那么的拉跨，相同规格的 AMD 版本比 Intel 便宜好几百，所以最终选的这个能 PD 充电，只有 AMD 集显，8 核 16 线程 32G 内存的电脑，只想拿它写代码，本地跑编译，跑 KVM 虚拟机用（稍微吐嘈一下某 ARM 架构的电脑，KVM 虚拟机各种限制，想建一个 NAT 类型的 Libvirt Network 都不行）。\n为避免引战，这里先只说一下咱个人的观点，可能是因为折腾 Linux 系统时间很久了吧所以对咱来说最舒服的系统还是 Linux，咱很赞同 Linus TechTips 这个视频里对 macOS 的吐嘈，因为 Win/Linux 与 macOS 的键盘、快捷键、手势操作、鼠标指针加速度不一致，所以想同时适应两套不同的手势快捷键、鼠标加速度很是让人头疼。不过这些在倒是能在长时间的适应之后通过修改系统设置的快捷键布局、安装第三方的鼠标加速度修复工具、和第三方输入法来缓解。\n咳，还是要再强调一下，咱只是个人觉得水果的电脑不太好用，尤其是需要 Mac + Win + Linux 来回切换着使用的情况下，很折磨。加上咱眼睛对 LED 的低频 PWM 调光敏感，所以显示设备都尽可能的买低蓝光的 DC 调光 LCD 屏了。\n安装 Arch Linux 其实咱是直接把之前的 R7000p 的硬盘拆下来装到 Thinkbook 16 的第二硬盘插槽里了，所以没有重装系统的步骤，卸载掉 NVIDIA 驱动，改了 SWAP 分区大小就可以用，不需要再配置双显卡切换的工具，没遇到什么奇葩的问题。\nWayland 因为 16 寸的 2K 屏幕，不调缩放的情况下显示的图标和字会特别小，所以需要启用分数倍缩放。X11 只能整数倍缩放，但笔记本只有一个 AMD GPU，所以可以完美使用 Wayland（没有英伟达显卡真的太爽了哈哈哈哈hhh）。\n切换到 Wayland 并启用 150% 的分数倍缩放后，终于不需要再拿显微镜看屏幕的图标和文字了，但很快就会发现 Chrome 和 Electron 的应用的文字全是模糊的，强迫症当然不能忍，查了一下发现原来虽然系统切到 Wayland 了，但这些应用依旧在使用 X 没有切换成 Wayland。\n所以对于 Chrome，需要创建 ~/.config/chrome-flags.conf 加几个 Flag 使用 GTK4。\n--gtk-version=4 --ozone-platform=wayland --enable-wayland-ime 那些基于 Electron 的应用，例如 Visual Studio Code，设置 ~/.config/code-flags.conf：\n--gtk-version=4 --enable-wayland-ime 然后如果你是 GNOME 用户，你会发现把 Chrome/Electron 切换到 Wayland 后没办法使用第三方输入法，因为 GNOME 不支持 text-input-v1 而 Chromium 只支持 text-input-v3，所以对于这个问题，目前的 Workaround 是安装 archlinuxcn/mutter-performance 替换掉 GNOME 的 mutter。\n不过这个不是十分完美的解决方法，VSCode 在启动多个窗口，放到不同的 Workspace 里会遇到鼠标右键点不开和输入法的问题，不过勉强能接受，所以不管了（或者我最近在考虑要不要换一个文本编辑器而不是 VSCode）。\n然后就是 Chromium 最近好像在支持 text-input-v3 了，所以别骂了别骂了，不要再黑 GNOME 了……\n所以现在就是，每新安装一个 Electron 应用，都得给他创建个 ~/.config/[NAME].conf……\n--enable-wayland-ime 吐嘈 以后再买笔记本时要多留意一下，尽量别买高分屏（但现在中高端本全是高分屏），还要避免双显卡，一旦买了双显卡的电脑大概率没办法用 Wayland，还要多花好多时间折腾双显卡混合交火，还得规避掉英伟达新版本驱动会 Kernel Panic 的 Bug。\n一旦你买了双显卡高分屏笔记本，那么恭喜你只能用 X11，没有分数倍缩放，所以你只需要准备一个放大镜用来看屏幕就能解决问题（确信）。\n",
  "wordCount" : "1397",
  "inLanguage": "zh",
  "image": "https://blog.starry-s.moe/web-app-manifest-512x512.png","datePublished": "2024-08-05T01:02:47+08:00",
  "dateModified": "2024-08-05T01:02:47+08:00",
  "author":{
    "@type": "Person",
    "name": "STARRY-S"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.starry-s.moe/posts/2024/lenovo-thinkbook-16-6g/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "STARRY-S' Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.starry-s.moe/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.starry-s.moe/" accesskey="h" title="Home (Alt + H)">
                <img src="https://blog.starry-s.moe/web-app-manifest-192x192.png" alt="" aria-label="logo"
                    height="24">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.starry-s.moe/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://blog.starry-s.moe/gallery/" title="相册">
                    <span>相册</span>
                </a>
            </li>
            <li>
                <a href="https://blog.starry-s.moe/links/" title="友链">
                    <span>友链</span>
                </a>
            </li>
            <li>
                <a href="https://blog.starry-s.moe/projects/" title="项目">
                    <span>项目</span>
                </a>
            </li>
            <li>
                <a href="https://blog.starry-s.moe/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://blog.starry-s.moe/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.starry-s.moe/">主页</a>&nbsp;»&nbsp;<a href="https://blog.starry-s.moe/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      联想 ThinkBook 16 Gen6 安装 Arch Linux
    </h1>
    <div class="post-meta"><span title='2024-08-05 01:02:47 +0800 +0800'>2024-08-05 01:02:47 +0800</span>&nbsp;·&nbsp;<span>3 分钟</span>&nbsp;·&nbsp;<span>1397 字</span>&nbsp;·&nbsp;<span>STARRY-S</span>&nbsp;|&nbsp;<span>
    <a href="https://github.com/STARRY-S/blog/edit/main/content/posts/2024/lenovo-thinkbook-16-6g/index.md" rel="noopener noreferrer edit" target="_blank">Edit Text</a>
</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#起因">起因</a></li>
    <li><a href="#安装-arch-linux">安装 Arch Linux</a>
      <ul>
        <li><a href="#wayland">Wayland</a></li>
      </ul>
    </li>
    <li><a href="#吐嘈">吐嘈</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>本来没打算这么早换笔记本，但是之前大学时买的联想 R7000P 它坏了……</p>
<hr>
<meting-js server="netease" type="song" id="590252" theme="#233333"></meting-js>
<h2 id="起因">起因<a hidden class="anchor" aria-hidden="true" href="#起因">#</a></h2>
<blockquote>
<p>这段基本是废话，可以直接跳过……</p>
</blockquote>
<p>旧笔记本经常蓝屏死机掉驱动重启，送修过一次但依旧没修好，于是把它当有问题的二手电脑卖掉了，买了今年新出的联想 ThinkBook 16 Gen6。因为咱有台式，所以笔记本的需求就是轻薄，Linux 友好，便宜就行。之前总是被笔记本的双显卡驱动折磨得头疼，英伟达显卡驱动 4202 年了依旧是那么的拉跨，相同规格的 AMD 版本比 Intel 便宜好几百，所以最终选的这个能 PD 充电，只有 AMD 集显，8 核 16 线程 32G 内存的电脑，只想拿它写代码，本地跑编译，跑 KVM 虚拟机用（稍微吐嘈一下某 ARM 架构的电脑，KVM 虚拟机各种限制，想建一个 NAT 类型的 Libvirt Network 都不行）。</p>
<p>为避免引战，这里先只说一下咱个人的观点，可能是因为折腾 Linux 系统时间很久了吧所以对咱来说最舒服的系统还是 Linux，咱很赞同 Linus TechTips 这个视频里对 macOS 的吐嘈，因为 Win/Linux 与 macOS 的键盘、快捷键、手势操作、鼠标指针加速度不一致，所以想同时适应两套不同的手势快捷键、鼠标加速度很是让人头疼。不过这些在倒是能在长时间的适应之后通过修改系统设置的快捷键布局、安装第三方的鼠标加速度修复工具、和第三方输入法来缓解。</p>
<iframe src="//player.bilibili.com/player.html?isOutside=true&aid=563073437&bvid=BV1Rv4y127d5&cid=904126423&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>
<p>咳，还是要再强调一下，咱只是个人觉得水果的电脑不太好用，尤其是需要 Mac + Win + Linux 来回切换着使用的情况下，很折磨。加上咱眼睛对 LED 的低频 PWM 调光敏感，所以显示设备都尽可能的买低蓝光的 DC 调光 LCD 屏了。</p>
<h2 id="安装-arch-linux">安装 Arch Linux<a hidden class="anchor" aria-hidden="true" href="#安装-arch-linux">#</a></h2>
<p>其实咱是直接把之前的 R7000p 的硬盘拆下来装到 Thinkbook 16 的第二硬盘插槽里了，所以没有重装系统的步骤，卸载掉 NVIDIA 驱动，改了 SWAP 分区大小就可以用，不需要再配置双显卡切换的工具，没遇到什么奇葩的问题。</p>
<h3 id="wayland">Wayland<a hidden class="anchor" aria-hidden="true" href="#wayland">#</a></h3>
<p>因为 16 寸的 2K 屏幕，不调缩放的情况下显示的图标和字会特别小，所以需要启用分数倍缩放。X11 只能整数倍缩放，但笔记本只有一个 AMD GPU，所以可以完美使用 Wayland（没有英伟达显卡真的太爽了哈哈哈哈hhh）。</p>
<p><img loading="lazy" src="images/1.png" alt="" />

</p>
<p>切换到 Wayland 并启用 150% 的分数倍缩放后，终于不需要再拿显微镜看屏幕的图标和文字了，但很快就会发现 Chrome 和 Electron 的应用的文字全是模糊的，强迫症当然不能忍，查了一下发现原来虽然系统切到 Wayland 了，但这些应用依旧在使用 X 没有切换成 Wayland。</p>
<p>所以对于 Chrome，需要创建 <code>~/.config/chrome-flags.conf</code> 加几个 Flag 使用 GTK4。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">--gtk-version=4 --ozone-platform=wayland --enable-wayland-ime
</span></span></code></pre></div><p>那些基于 Electron 的应用，例如 Visual Studio Code，设置 <code>~/.config/code-flags.conf</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">--gtk-version=4 --enable-wayland-ime
</span></span></code></pre></div><p>然后如果你是 GNOME 用户，你会发现把 Chrome/Electron 切换到 Wayland 后没办法使用第三方输入法，因为 GNOME 不支持 <code>text-input-v1</code> 而 Chromium 只支持 <code>text-input-v3</code>，所以对于这个问题，目前的 Workaround 是安装 <code>archlinuxcn/mutter-performance</code> 替换掉 GNOME 的 <code>mutter</code>。</p>
<p>不过这个不是十分完美的解决方法，VSCode 在启动多个窗口，放到不同的 Workspace 里会遇到鼠标右键点不开和输入法的问题，不过勉强能接受，所以不管了（或者我最近在考虑要不要换一个文本编辑器而不是 VSCode）。</p>
<p>然后就是 Chromium 最近好像在支持 <code>text-input-v3</code> 了，所以别骂了别骂了，不要再黑 GNOME 了……</p>
<hr>
<p>所以现在就是，每新安装一个 Electron 应用，都得给他创建个 <code>~/.config/[NAME].conf</code>……</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">--enable-wayland-ime
</span></span></code></pre></div><h2 id="吐嘈">吐嘈<a hidden class="anchor" aria-hidden="true" href="#吐嘈">#</a></h2>
<p>以后再买笔记本时要多留意一下，尽量别买高分屏（但现在中高端本全是高分屏），还要避免双显卡，一旦买了双显卡的电脑大概率没办法用 Wayland，还要多花好多时间折腾双显卡混合交火，还得规避掉英伟达新版本驱动会 Kernel Panic 的 Bug。</p>
<p>一旦你买了双显卡高分屏笔记本，那么恭喜你只能用 X11，没有分数倍缩放，所以你只需要准备一个放大镜用来看屏幕就能解决问题（确信）。</p>
<p><img loading="lazy" src="images/2.png" alt="" />

</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.starry-s.moe/tags/arch-linux/">Arch Linux</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://blog.starry-s.moe/posts/2024/pandavan-uu-booster/">
    <span class="title">« 上一页</span>
    <br>
    <span>Pandavan 安装 UU 加速器插件</span>
  </a>
  <a class="next" href="https://blog.starry-s.moe/posts/2024/container-network-2/">
    <span class="title">下一页 »</span>
    <br>
    <span>再探容器网络</span>
  </a>
</nav>

  </footer><div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "starry-s-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>
    </main>
    
<footer class="footer">
        <span>© 2016 - 2026 STARRY-S | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> | Hosted on <a href="https://pages.github.com">GitHub Pages</a><br /></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script>
  const pathname = window.location.pathname;
  const images = document.querySelectorAll('img');

  Array.from(images).forEach(image => {
    if (!pathname.includes("/posts/")) {
      return;
    }
    if (image.src.indexOf('images') < 0) {
      return
    }
    image.addEventListener('load', () => fitImage(image));
    if (image.complete && image.naturalWidth !== 0) {
      fitImage(image);
    }
  });

  function fitImage(image) {
    image.style.marginLeft = 'auto';
    image.style.marginRight = 'auto';
    
    if (image.naturalWidth / image.naturalHeight < 1.1) {
      image.style.maxWidth = '60%';
      image.style.height = 'auto';
    }
  }
</script>

<script src="/js/home-info.js"></script>


<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
